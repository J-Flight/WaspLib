(*
# Inventory Form
This page is about {ref}`Inventory Layouts` dedicated `TLazForm` utilities.

This is meant to be used with {ref}`TScriptForm` with
{ref}`TScriptForm.CreateInventoryTab` and will setup a a `TLazTabSheet` on it
with several controls to configure the {ref}`Inventory Layouts`:
```{figure} ../../images/inventoryform.png
```
*)

{$DEFINE WL_INVENTORY_FORM_INCLUDED}
{$INCLUDE_ONCE WaspLib/osrs.simba}

type
(*
## TInventoryFormHelper
The `TInventoryFormHelper` type is, as it's name implies a helper type for the
`Inventory Form`.

It has a lot of methods and callbacks that are hidden by default and won't be
mentioned on this page because they are internal methods you shouldn't touch.

Do feel free to read the source code though if you so desire.
*)
  TInventoryFormHelper = record
    Layouts: array of TRSInventoryLayoutSlots;
    Index: Integer;

    LinkedComboboxes: array of TLazComboBox;

    Config: TConfigJSON;
    const BACKGROUND_IMG: TImage = ImageFromString('IMG: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');
  end;

procedure TInventoryFormHelper.Setup();
var
  i: Integer;
  slot: Integer;
begin
  Self.Config.Setup('inventorylayouts' + PATH_SEP + ToStr(PlayerIndex));
  SetLength(Self.Layouts, Self.Config.Data.Count);

  try
    for i := 0 to Self.Config.Data.Count-1 do
    begin
      Self.Layouts[i].Name := Self.Config.Data.Key[i];

      for slot := 0 to 27 do
      begin
        Self.Layouts[i].Items[slot].Item   := Self.Config.Data.Item[i].Item[slot].Item[0].AsString;
        Self.Layouts[i].Items[slot].Amount := Self.Config.Data.Item[i].Item[slot].Item[1].AsInt;
      end;
    end;
  except
    FileDelete(Self.Config.Path); //corrupted config.
  end;
end;

(*
## InventoryForm.CreateGearCombobox
```pascal
function TInventoryFormHelper.CreateGearCombobox(owner: Pointer; caption: TLazLabel = nil): TLazComboBox;
```
This is the only method from {ref}`Gear Form` you might need to use.
This will create a combobox for you whose contents auto-update with changes made
on the `Gear Form`.
*)
function TInventoryFormHelper.CreateInventoryCombobox(owner: Pointer; caption: String = 'Inventory Layout:'; left, top: Integer = 0): TLazComboBox;
var
  i: Integer;
begin
  Result := TLazComboBox.CreateEx(owner, caption, 'Pick an inventory layout.', left, top, 170, 40);
  Self.LinkedComboboxes += Result;

  for i := 0 to High(Self.Layouts) do
    Result.Items.Add(Self.Layouts[i].Name);

  Result.ItemIndex := Low(Self.Layouts);
end;

var
(*
## InventoryForm variable
Global {ref}`TInventoryFormHelper` variable.
*)
  InventoryForm: TInventoryFormHelper;

(*
## ScriptForm CreateInventoryTab
```pascal
function TScriptForm.CreateInventoryTab(): TLazTabSheet;
```
Sets up a `TLazTabSheet` on your `TScriptForm` to configure your `Inventory Layouts`.

Example:
```pascal
{$I WaspLib/osrs.simba}
var
  form: TScriptForm;
begin
  form.Setup();
  form.CreateInventoryTab();
  form.Run();
end.
```
```{figure} ../../images/inventoryform.gif
```
For a more complete example check out the file `Simba/Includes/WaspLib/examples/inventory_form.simba`.
*)
function TScriptForm.CreateInventoryTab(): TLazTabSheet;
begin
  Result := Self.CreateTab('Inventory Layouts');
end;
